{"version":3,"file":"suit.min.js","sources":["../frontend/js/suit.js"],"sourcesContent":["import $ from 'jquery';\n\n\nfunction getPadding($tr) {\n    return parseInt($tr.find('th:first').css('padding-left'));\n}\n\nfunction findWithChildren($tr) {\n    var padding = getPadding($tr);\n    return $tr.nextUntil(function () {\n        return getPadding($(this)) <= padding\n    }).andSelf();\n}\n\nexport class Suit {\n    // Register callbacks to perform after inline has been added\n    after_inline() {\n        const functions = {};\n        const register = (fn_name, fn_callback) => {\n            functions[fn_name] = fn_callback;\n        };\n\n        const run = (inline_prefix, row) => {\n            for (const fn_name in functions) {\n                functions[fn_name](inline_prefix, row);\n            }\n        };\n\n        return {\n            register,\n            run\n        };\n    }\n\n    ListActionsToggle() {\n        let $topActions;\n\n        const init = () => {\n            $(document).ready(() => {\n                $topActions = $('.results').parent().find('.actions').eq(0);\n                if (!$topActions.length)\n                    return;\n\n                $(\"tr input.action-select, #action-toggle\").on('click', checkIfSelected);\n            });\n        };\n\n        const checkIfSelected = () => {\n            if ($('tr.selected').length) {\n                $topActions.slideDown('fast');\n            } else {\n                $topActions.slideUp('fast');\n            }\n        };\n\n        return {\n            init\n        }\n    }\n\n    FixedBar() {\n        let didScroll = false;\n        let $fixedItem;\n        let $fixedItemParent;\n        let $win;\n        let itemOffset;\n        const extraOffset = 0;\n        let fixed = false;\n\n        function init(selector) {\n            $fixedItem = $(selector || '.submit-row');\n            if (!$fixedItem.length)\n                return;\n\n            $fixedItemParent = $fixedItem.parents('form');\n            itemOffset = $fixedItem.offset();\n            $win = $(window);\n            window.onscroll = onScroll;\n            window.onresize = onScroll;\n            onScroll();\n\n            setInterval(() => {\n                if (didScroll) {\n                    didScroll = false;\n                }\n            }, 200);\n        }\n\n        function onScroll() {\n            didScroll = true;\n\n            const itemHeight = $fixedItem.height();\n            const scrollTop = $win.scrollTop();\n\n            if (scrollTop + $win.height() - itemHeight - extraOffset < itemOffset.top) {\n                if (!fixed) {\n                    $fixedItem.addClass('fixed');\n                    $fixedItemParent.addClass('fixed').css('padding-bottom', `${itemHeight}px`);\n                    fixed = true;\n                }\n            } else {\n                if (fixed) {\n                    $fixedItem.removeClass('fixed');\n                    $fixedItemParent.removeClass('fixed').css('padding-bottom', '');\n                    fixed = false;\n                }\n            }\n        }\n\n        return {\n            init\n        }\n    }\n}\n\nconst suit = new Suit();\nwindow.Suit = Suit;\n\n\n/**\n * Avoids double-submit issues in the change_form.\n */\n$.fn.suitFormDebounce = function () {\n    const $form = $(this);\n    const $saveButtons = $form.find('.submit-row button, .submit-row input[type=button], .submit-row input[type=submit]');\n    let submitting = false;\n\n    $form.submit(() => {\n        if (submitting) {\n            return false;\n        }\n\n        submitting = true;\n        $saveButtons.addClass('disabled');\n\n        setTimeout(() => {\n            $saveButtons.removeClass('disabled');\n            submitting = false;\n        }, 5000);\n    });\n};\n\n/**\n * Content tabs\n */\n$.fn.suitFormTabs = function () {\n\n    const $tabs = $(this);\n    const tabPrefix = $tabs.data('tab-prefix');\n    if (!tabPrefix)\n        return;\n\n    const $tabLinks = $tabs.find('a');\n\n    function tabContents($link) {\n        return $(`.${tabPrefix}-${$link.attr('href').replace('#', '')}`);\n    }\n\n    function activateTabs() {\n        // Init tab by error, by url hash or init first tab\n        if (window.location.hash) {\n            let foundError;\n            $tabLinks.each(function () {\n                const $link = $(this);\n                if (tabContents($link).find('.error, .errorlist').length !== 0) {\n                    $link.addClass('has-error');\n                    $link.trigger('click');\n                    foundError = true;\n                }\n            });\n            !foundError && $($tabs).find(`a[href=\\\\${window.location.hash}]`).click();\n        } else {\n            $tabLinks.first().trigger('click');\n        }\n    }\n\n    $tabLinks.click(function () {\n        const $link = $(this);\n\n        const showEvent = $.Event('shown.suit.tab', {\n            relatedTarget: $link,\n            tab: $link.attr('href').replace('#', '')\n        });\n\n        $link.parent().parent().find('.active').removeClass('active');\n        $link.addClass('active');\n        $(`.${tabPrefix}`).removeClass('show').addClass('hidden-xs-up');\n        tabContents($link).removeClass('hidden-xs-up').addClass('show');\n        $link.trigger(showEvent);\n    });\n\n    activateTabs();\n};\n\n\n/* Characters count for CharacterCountTextarea */\n$.fn.suitCharactersCount = function () {\n    const $elements = $(this);\n\n    if (!$elements.length)\n        return;\n\n    $elements.each(function () {\n        const $el = $(this);\n        const $countEl = $('<div class=\"suit-char-count\"></div>');\n        $el.after($countEl);\n        $el.on('keyup', e => {\n            updateCount($(e.currentTarget));\n        });\n        updateCount($el);\n    });\n\n    function updateCount($el) {\n        const maxCount = $el.data('suit-maxcount');\n        const twitterCount = $el.data('suit-twitter-count');\n        const value = $el.val();\n        const len = twitterCount ? getTweetLength(value) : value.length;\n        let count = maxCount ? maxCount - len : len;\n        if (count < 0)\n            count = `<span class=\"text-danger\">${count}</span>`;\n\n        $el.next().first().html(count);\n    }\n\n    function getTweetLength(input) {\n        let tmp = \"\";\n        for (let i = 0; i < 23; i++) {\n            tmp += \"o\"\n        }\n        return input.replace(/(http:\\/\\/[\\S]*)/g, tmp).length;\n    }\n};\n\n\n/**\n * Search filters - submit only changed fields\n */\n$.fn.suitSearchFilters = function () {\n    $(this).change(function () {\n        const $field = $(this);\n        const $option = $field.find('option:selected');\n        const select_name = $option.data('name');\n        if (select_name) {\n            $field.attr('name', select_name);\n        } else {\n            $field.removeAttr('name');\n        }\n        // Handle additional values for date filters\n        let additional = $option.data('additional');\n        console.log($field, additional);\n        if (additional) {\n            const hiddenId = `${$field.data('name')}_add`;\n            let $hidden = $(`#${hiddenId}`);\n            if (!$hidden.length) {\n                $hidden = $('<input/>').attr('type', 'hidden').attr('id', hiddenId);\n                $field.after($hidden);\n            }\n            additional = additional.split('=');\n            $hidden.attr('name', additional[0]).val(additional[1])\n        }\n    });\n    $(this).trigger('change');\n};\n\n\n$.fn.suit_list_sortable = function () {\n    const $inputs = $(this);\n    if (!$inputs.length)\n        return;\n\n    // Detect if this is normal or mptt table\n    const mptt_table = $inputs.first().closest('table').hasClass('table-mptt');\n\n    function performMove($arrow, $row) {\n        let $next;\n        let $prev;\n\n        $row.closest('table').find('tr.selected').removeClass('selected');\n        if (mptt_table) {\n            const padding = getPadding($row);\n            const $rows_to_move = findWithChildren($row);\n            if ($arrow.data('dir') === 'down') {\n                $next = $rows_to_move.last().next();\n                if ($next.length && getPadding($next) === padding) {\n                    const $after = findWithChildren($next).last();\n                    if ($after.length) {\n                        $rows_to_move.insertAfter($after).addClass('selected');\n                    }\n                }\n            } else {\n                $prev = $row.prevUntil(function () {\n                    return getPadding($(this)) <= padding\n                }).andSelf().first().prev();\n                if ($prev.length && getPadding($prev) === padding) {\n                    $rows_to_move.insertBefore($prev).addClass('selected')\n                }\n            }\n        } else {\n            if ($arrow.data('dir') === 'down') {\n                $next = $row.next();\n                if ($next.is(':visible') && $next.length) {\n                    $row.insertAfter($next).addClass('selected')\n                }\n            } else {\n                $prev = $row.prev();\n                if ($prev.is(':visible') && $prev.length) {\n                    $row.insertBefore($prev).addClass('selected')\n                }\n            }\n        }\n        markLastInline($row.parent());\n    }\n\n    function onArrowClick(e) {\n        const $sortable = $(this);\n        const $row = $sortable.closest(\n            $sortable.hasClass('sortable-stacked') ? 'div.inline-related' : 'tr'\n        );\n        performMove($sortable, $row);\n        e.preventDefault();\n    }\n\n    function createLink(text, direction, on_click_func, is_stacked) {\n        return $('<a/>').attr('href', '#')\n            .addClass(`sortable sortable-${direction}${is_stacked ? ' sortable-stacked' : ''}`)\n            .attr('data-dir', direction).html(text)\n            .on('click', on_click_func);\n    }\n\n    function markLastInline($rowParent) {\n        $rowParent.find(' > .last-sortable').removeClass('last-sortable');\n        $rowParent.find('tr.form-row:visible:last').addClass('last-sortable');\n    }\n\n    let $lastSortable;\n    $inputs.each(function () {\n        const $inline_sortable = $('<div class=\"inline-sortable\"/>');\n        const icon = '<span class=\"fa fa-lg fa-arrow-up\"></span>';\n        const $sortable = $(this);\n        const is_stacked = $sortable.hasClass('suit-sortable-stacked');\n        const $up_link = createLink(icon, 'up', onArrowClick, is_stacked);\n        const $down_link = createLink(icon.replace('-up', '-down'), 'down', onArrowClick, is_stacked);\n\n        if (is_stacked) {\n            const $sortable_row = $sortable.closest('div.form-group');\n            const $stacked_block = $sortable.closest('div.inline-related');\n            const $links_span = $('<span/>').attr('class', 'stacked-inline-sortable');\n\n            // Add arrows to header h3, move order input and remove order field row\n            $links_span.append($up_link).append($down_link);\n            $links_span.insertAfter($stacked_block.find('.inline_label'));\n            $stacked_block.append($sortable);\n            $sortable_row.remove();\n        } else {\n            $sortable.parent().append($inline_sortable);\n            $inline_sortable.append($up_link);\n            $inline_sortable.append($down_link);\n            $lastSortable = $sortable;\n        }\n    });\n\n    $lastSortable && markLastInline($lastSortable.closest('.form-row').parent());\n\n    // Filters out unchanged checkboxes, selects and sortable field itself\n    function filter_unchanged(i, input) {\n        if (input.type === 'checkbox') {\n            if (input.defaultChecked === input.checked) {\n                return false;\n            }\n        } else if (input.type === 'select-one' || input.type === 'select-multiple') {\n            const options = input.options;\n            let option;\n            for (let j = 0; j < options.length; j++) {\n                option = options[j];\n                if (option.selected && option.selected === option.defaultSelected) {\n                    return false;\n                }\n            }\n        } else if ($(input).hasClass('suit-sortable')) {\n            if (input.defaultValue === input.value && input.value === 0) {\n                return false;\n            }\n        }\n        return true;\n    }\n\n    // Update input count right before submit\n    if ($inputs && $inputs.length) {\n        const $last_input = $inputs.last();\n        const selector = $(this).selector;\n        $($last_input[0].form).submit(e => {\n            let i = 0;\n            let value;\n            // e.preventDefault();\n            $(selector).each(function () {\n                const $input = $(this);\n                const fieldset_id = $input.attr('name').split(/-\\d+-/)[0];\n                // Check if any of new dynamic block values has been added\n                const $set_block = $input.closest(`.dynamic-${fieldset_id}`);\n                const $changed_fields = $set_block.find(\":input[type!='hidden']:not(.suit-sortable)\").filter(\n                    function () {\n                        return $(this).val() !== \"\";\n                    }).filter(filter_unchanged);\n                // console.log($changed_fields.length, $changed_fields);\n                const is_changelist = !$set_block.length;\n                if (is_changelist\n                    || $set_block.hasClass('has_original')\n                    || $changed_fields.serializeArray().length\n                    // Since jQuery serialize() doesn't include type=file do additional check\n                    || $changed_fields.find(\":input[type='file']\").addBack().length) {\n                    value = i++;\n                    $input.val(value);\n                }\n            });\n        });\n    }\n\n    suit.after_inline.register('bind_sortable_arrows', (prefix, row) => {\n        $(row).find('.suit-sortable').on('click', onArrowClick);\n        markLastInline($(row).parent());\n    });\n};\n\n\n$('.suit-sortable').suit_list_sortable();\n\n$(document).on('formset:added', (e, row, prefix) => {\n    suit.after_inline.run(prefix, row);\n});\n"],"names":["getPadding","$tr","parseInt","find","css","findWithChildren","padding","nextUntil","$","andSelf","Suit","functions","register","fn_name","fn_callback","run","inline_prefix","row","$topActions","init","document","ready","parent","eq","length","on","checkIfSelected","slideDown","slideUp","$fixedItem","$fixedItemParent","$win","itemOffset","extraOffset","fixed","selector","parents","offset","window","onscroll","onScroll","onresize","setInterval","didScroll","itemHeight","height","scrollTop","top","addClass","removeClass","suit","fn","suitFormDebounce","$form","$saveButtons","submitting","submit","setTimeout","suitFormTabs","$tabs","tabPrefix","data","$tabLinks","tabContents","$link","attr","replace","activateTabs","location","hash","foundError","each","trigger","click","first","showEvent","Event","relatedTarget","tab","suitCharactersCount","$elements","$el","$countEl","after","updateCount","e","currentTarget","maxCount","twitterCount","value","val","len","getTweetLength","count","next","html","input","tmp","i","suitSearchFilters","change","$field","$option","select_name","removeAttr","additional","console","log","hiddenId","$hidden","split","suit_list_sortable","$inputs","mptt_table","closest","hasClass","performMove","$arrow","$row","$next","$prev","$rows_to_move","last","$after","insertAfter","prevUntil","prev","insertBefore","is","markLastInline","onArrowClick","$sortable","preventDefault","createLink","text","direction","on_click_func","is_stacked","$rowParent","$lastSortable","$inline_sortable","icon","$up_link","$down_link","$sortable_row","$stacked_block","$links_span","append","remove","filter_unchanged","type","defaultChecked","checked","options","option","j","selected","defaultSelected","defaultValue","$last_input","form","$input","fieldset_id","$set_block","$changed_fields","filter","is_changelist","serializeArray","addBack","after_inline","prefix"],"mappings":"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"}